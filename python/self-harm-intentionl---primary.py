# Matthew J Carr, Sarah Steeg, Roger T Webb, Nav Kapur, Carolyn A Chew-Graham, Kathrym M Abel, Holly Hope, Matthias Pierce, Darren M. Ashcroft, 2023.

import sys, csv, re

codes = [{"code":"14K1.00","system":"readv2"},{"code":"U2...00","system":"readv2"},{"code":"U20..00","system":"readv2"},{"code":"U200.00","system":"readv2"},{"code":"U200000","system":"readv2"},{"code":"U200100","system":"readv2"},{"code":"U200200","system":"readv2"},{"code":"U200300","system":"readv2"},{"code":"U200400","system":"readv2"},{"code":"U200500","system":"readv2"},{"code":"U200600","system":"readv2"},{"code":"U200700","system":"readv2"},{"code":"U200y00","system":"readv2"},{"code":"U200z00","system":"readv2"},{"code":"U201.00","system":"readv2"},{"code":"U201000","system":"readv2"},{"code":"U201100","system":"readv2"},{"code":"U201200","system":"readv2"},{"code":"U201300","system":"readv2"},{"code":"U201400","system":"readv2"},{"code":"U201500","system":"readv2"},{"code":"U201600","system":"readv2"},{"code":"U201700","system":"readv2"},{"code":"U201y00","system":"readv2"},{"code":"U201z00","system":"readv2"},{"code":"U202.00","system":"readv2"},{"code":"U202000","system":"readv2"},{"code":"U202100","system":"readv2"},{"code":"U202200","system":"readv2"},{"code":"U202300","system":"readv2"},{"code":"U202400","system":"readv2"},{"code":"U202500","system":"readv2"},{"code":"U202600","system":"readv2"},{"code":"U202700","system":"readv2"},{"code":"U202y00","system":"readv2"},{"code":"U202z00","system":"readv2"},{"code":"U203.00","system":"readv2"},{"code":"U203000","system":"readv2"},{"code":"U203100","system":"readv2"},{"code":"U203200","system":"readv2"},{"code":"U203300","system":"readv2"},{"code":"U203400","system":"readv2"},{"code":"U203500","system":"readv2"},{"code":"U203600","system":"readv2"},{"code":"U203700","system":"readv2"},{"code":"U203y00","system":"readv2"},{"code":"U203z00","system":"readv2"},{"code":"U204.00","system":"readv2"},{"code":"U204000","system":"readv2"},{"code":"U204100","system":"readv2"},{"code":"U204200","system":"readv2"},{"code":"U204300","system":"readv2"},{"code":"U204400","system":"readv2"},{"code":"U204500","system":"readv2"},{"code":"U204600","system":"readv2"},{"code":"U204700","system":"readv2"},{"code":"U204y00","system":"readv2"},{"code":"U204z00","system":"readv2"},{"code":"U205.00","system":"readv2"},{"code":"U205000","system":"readv2"},{"code":"U205100","system":"readv2"},{"code":"U205200","system":"readv2"},{"code":"U205300","system":"readv2"},{"code":"U205400","system":"readv2"},{"code":"U205500","system":"readv2"},{"code":"U205600","system":"readv2"},{"code":"U205700","system":"readv2"},{"code":"U205y00","system":"readv2"},{"code":"U205z00","system":"readv2"},{"code":"U206.00","system":"readv2"},{"code":"U206000","system":"readv2"},{"code":"U206100","system":"readv2"},{"code":"U206200","system":"readv2"},{"code":"U206300","system":"readv2"},{"code":"U206400","system":"readv2"},{"code":"U206500","system":"readv2"},{"code":"U206600","system":"readv2"},{"code":"U206700","system":"readv2"},{"code":"U206y00","system":"readv2"},{"code":"U206z00","system":"readv2"},{"code":"U208.00","system":"readv2"},{"code":"U209.00","system":"readv2"},{"code":"U209000","system":"readv2"},{"code":"U209100","system":"readv2"},{"code":"U209200","system":"readv2"},{"code":"U209300","system":"readv2"},{"code":"U209400","system":"readv2"},{"code":"U209500","system":"readv2"},{"code":"U209600","system":"readv2"},{"code":"U209700","system":"readv2"},{"code":"U209y00","system":"readv2"},{"code":"U209z00","system":"readv2"},{"code":"U20A.00","system":"readv2"},{"code":"U20A000","system":"readv2"},{"code":"U20A100","system":"readv2"},{"code":"U20A200","system":"readv2"},{"code":"U20A300","system":"readv2"},{"code":"U20A400","system":"readv2"},{"code":"U20A500","system":"readv2"},{"code":"U20A600","system":"readv2"},{"code":"U20A700","system":"readv2"},{"code":"U20Ay00","system":"readv2"},{"code":"U20Az00","system":"readv2"},{"code":"U20B.00","system":"readv2"},{"code":"U20B000","system":"readv2"},{"code":"U20B100","system":"readv2"},{"code":"U20B200","system":"readv2"},{"code":"U20B300","system":"readv2"},{"code":"U20B400","system":"readv2"},{"code":"U20B500","system":"readv2"},{"code":"U20B600","system":"readv2"},{"code":"U20B700","system":"readv2"},{"code":"U20By00","system":"readv2"},{"code":"U20Bz00","system":"readv2"},{"code":"U20C.00","system":"readv2"},{"code":"U20C000","system":"readv2"},{"code":"U20C100","system":"readv2"},{"code":"U20C200","system":"readv2"},{"code":"U20C300","system":"readv2"},{"code":"U20C400","system":"readv2"},{"code":"U20C500","system":"readv2"},{"code":"U20C600","system":"readv2"},{"code":"U20C700","system":"readv2"},{"code":"U20Cy00","system":"readv2"},{"code":"U20Cz00","system":"readv2"},{"code":"U20y.00","system":"readv2"},{"code":"U20y000","system":"readv2"},{"code":"U20y100","system":"readv2"},{"code":"U20y200","system":"readv2"},{"code":"U20y300","system":"readv2"},{"code":"U20y400","system":"readv2"},{"code":"U20y500","system":"readv2"},{"code":"U20y600","system":"readv2"},{"code":"U20y700","system":"readv2"},{"code":"U20yy00","system":"readv2"},{"code":"U20yz00","system":"readv2"},{"code":"U21..00","system":"readv2"},{"code":"U210.00","system":"readv2"},{"code":"U211.00","system":"readv2"},{"code":"U213.00","system":"readv2"},{"code":"U214.00","system":"readv2"},{"code":"U215.00","system":"readv2"},{"code":"U216.00","system":"readv2"},{"code":"U217.00","system":"readv2"},{"code":"U21z.00","system":"readv2"},{"code":"U22..00","system":"readv2"},{"code":"U220.00","system":"readv2"},{"code":"U221.00","system":"readv2"},{"code":"U222.00","system":"readv2"},{"code":"U223.00","system":"readv2"},{"code":"U224.00","system":"readv2"},{"code":"U225.00","system":"readv2"},{"code":"U226.00","system":"readv2"},{"code":"U227.00","system":"readv2"},{"code":"U22z.00","system":"readv2"},{"code":"U23..00","system":"readv2"},{"code":"U230.00","system":"readv2"},{"code":"U231.00","system":"readv2"},{"code":"U233.00","system":"readv2"},{"code":"U234.00","system":"readv2"},{"code":"U235.00","system":"readv2"},{"code":"U236.00","system":"readv2"},{"code":"U237.00","system":"readv2"},{"code":"U23z.00","system":"readv2"},{"code":"U24..00","system":"readv2"},{"code":"U240.00","system":"readv2"},{"code":"U241.00","system":"readv2"},{"code":"U243.00","system":"readv2"},{"code":"U244.00","system":"readv2"},{"code":"U245.00","system":"readv2"},{"code":"U247.00","system":"readv2"},{"code":"U24z.00","system":"readv2"},{"code":"U25..00","system":"readv2"},{"code":"U26..00","system":"readv2"},{"code":"U260.00","system":"readv2"},{"code":"U261.00","system":"readv2"},{"code":"U262.00","system":"readv2"},{"code":"U263.00","system":"readv2"},{"code":"U264.00","system":"readv2"},{"code":"U265.00","system":"readv2"},{"code":"U266.00","system":"readv2"},{"code":"U267.00","system":"readv2"},{"code":"U26z.00","system":"readv2"},{"code":"U27..00","system":"readv2"},{"code":"U270.00","system":"readv2"},{"code":"U271.00","system":"readv2"},{"code":"U272.00","system":"readv2"},{"code":"U273.00","system":"readv2"},{"code":"U274.00","system":"readv2"},{"code":"U275.00","system":"readv2"},{"code":"U276.00","system":"readv2"},{"code":"U277.00","system":"readv2"},{"code":"U27z.00","system":"readv2"},{"code":"U28..00","system":"readv2"},{"code":"U280.00","system":"readv2"},{"code":"U281.00","system":"readv2"},{"code":"U282.00","system":"readv2"},{"code":"U283.00","system":"readv2"},{"code":"U284.00","system":"readv2"},{"code":"U285.00","system":"readv2"},{"code":"U286.00","system":"readv2"},{"code":"U287.00","system":"readv2"},{"code":"U28z.00","system":"readv2"},{"code":"U29..00","system":"readv2"},{"code":"U290.00","system":"readv2"},{"code":"U291.00","system":"readv2"},{"code":"U293.00","system":"readv2"},{"code":"U294.00","system":"readv2"},{"code":"U295.00","system":"readv2"},{"code":"U296.00","system":"readv2"},{"code":"U297.00","system":"readv2"},{"code":"U29z.00","system":"readv2"},{"code":"U2A..00","system":"readv2"},{"code":"U2A0.00","system":"readv2"},{"code":"U2A1.00","system":"readv2"},{"code":"U2A3.00","system":"readv2"},{"code":"U2A4.00","system":"readv2"},{"code":"U2A5.00","system":"readv2"},{"code":"U2A6.00","system":"readv2"},{"code":"U2A7.00","system":"readv2"},{"code":"U2Az.00","system":"readv2"},{"code":"U2B..00","system":"readv2"},{"code":"U2B0.00","system":"readv2"},{"code":"U2B1.00","system":"readv2"},{"code":"U2B3.00","system":"readv2"},{"code":"U2B4.00","system":"readv2"},{"code":"U2B5.00","system":"readv2"},{"code":"U2B6.00","system":"readv2"},{"code":"U2B7.00","system":"readv2"},{"code":"U2Bz.00","system":"readv2"},{"code":"U2C..00","system":"readv2"},{"code":"U2C0.00","system":"readv2"},{"code":"U2C1.00","system":"readv2"},{"code":"U2C2.00","system":"readv2"},{"code":"U2C3.00","system":"readv2"},{"code":"U2C4.00","system":"readv2"},{"code":"U2C5.00","system":"readv2"},{"code":"U2C6.00","system":"readv2"},{"code":"U2C7.00","system":"readv2"},{"code":"U2Cz.00","system":"readv2"},{"code":"U2D..00","system":"readv2"},{"code":"U2D0.00","system":"readv2"},{"code":"U2D1.00","system":"readv2"},{"code":"U2D2.00","system":"readv2"},{"code":"U2D3.00","system":"readv2"},{"code":"U2D4.00","system":"readv2"},{"code":"U2D5.00","system":"readv2"},{"code":"U2D6.00","system":"readv2"},{"code":"U2D7.00","system":"readv2"},{"code":"U2Dz.00","system":"readv2"},{"code":"U2y..00","system":"readv2"},{"code":"U2z..00","system":"readv2"},{"code":"U2z0.00","system":"readv2"},{"code":"U2z1.00","system":"readv2"},{"code":"U2z2.00","system":"readv2"},{"code":"U2z3.00","system":"readv2"},{"code":"U2z4.00","system":"readv2"},{"code":"U2z5.00","system":"readv2"},{"code":"U2z6.00","system":"readv2"},{"code":"U2z7.00","system":"readv2"},{"code":"U2zz.00","system":"readv2"},{"code":"U40..00","system":"readv2"},{"code":"U400.00","system":"readv2"},{"code":"U400000","system":"readv2"},{"code":"U400100","system":"readv2"},{"code":"U400200","system":"readv2"},{"code":"U400300","system":"readv2"},{"code":"U400400","system":"readv2"},{"code":"U400500","system":"readv2"},{"code":"U400600","system":"readv2"},{"code":"U400700","system":"readv2"},{"code":"U400y00","system":"readv2"},{"code":"U400z00","system":"readv2"},{"code":"U401.00","system":"readv2"},{"code":"U401000","system":"readv2"},{"code":"U401100","system":"readv2"},{"code":"U401200","system":"readv2"},{"code":"U401300","system":"readv2"},{"code":"U401400","system":"readv2"},{"code":"U401500","system":"readv2"},{"code":"U401600","system":"readv2"},{"code":"U401700","system":"readv2"},{"code":"U401y00","system":"readv2"},{"code":"U401z00","system":"readv2"},{"code":"U402.00","system":"readv2"},{"code":"U402000","system":"readv2"},{"code":"U402100","system":"readv2"},{"code":"U402200","system":"readv2"},{"code":"U402300","system":"readv2"},{"code":"U402400","system":"readv2"},{"code":"U402500","system":"readv2"},{"code":"U402600","system":"readv2"},{"code":"U402700","system":"readv2"},{"code":"U402y00","system":"readv2"},{"code":"U402z00","system":"readv2"},{"code":"U403.00","system":"readv2"},{"code":"U403000","system":"readv2"},{"code":"U403100","system":"readv2"},{"code":"U403200","system":"readv2"},{"code":"U403300","system":"readv2"},{"code":"U403400","system":"readv2"},{"code":"U403500","system":"readv2"},{"code":"U403600","system":"readv2"},{"code":"U403700","system":"readv2"},{"code":"U403y00","system":"readv2"},{"code":"U403z00","system":"readv2"},{"code":"U404.00","system":"readv2"},{"code":"U404000","system":"readv2"},{"code":"U404100","system":"readv2"},{"code":"U404200","system":"readv2"},{"code":"U404300","system":"readv2"},{"code":"U404400","system":"readv2"},{"code":"U404500","system":"readv2"},{"code":"U404600","system":"readv2"},{"code":"U404700","system":"readv2"},{"code":"U404y00","system":"readv2"},{"code":"U404z00","system":"readv2"},{"code":"U407.00","system":"readv2"},{"code":"U408.00","system":"readv2"},{"code":"U409.00","system":"readv2"},{"code":"U409000","system":"readv2"},{"code":"U409100","system":"readv2"},{"code":"U409200","system":"readv2"},{"code":"U409300","system":"readv2"},{"code":"U409400","system":"readv2"},{"code":"U409500","system":"readv2"},{"code":"U409600","system":"readv2"},{"code":"U409700","system":"readv2"},{"code":"U409y00","system":"readv2"},{"code":"U409z00","system":"readv2"},{"code":"U40B.00","system":"readv2"},{"code":"U40B000","system":"readv2"},{"code":"U40B100","system":"readv2"},{"code":"U40B200","system":"readv2"},{"code":"U40B300","system":"readv2"},{"code":"U40B400","system":"readv2"},{"code":"U40B500","system":"readv2"},{"code":"U40B600","system":"readv2"},{"code":"U40B700","system":"readv2"},{"code":"U40By00","system":"readv2"},{"code":"U40Bz00","system":"readv2"},{"code":"U40C.00","system":"readv2"},{"code":"U40C000","system":"readv2"},{"code":"U40C100","system":"readv2"},{"code":"U40C200","system":"readv2"},{"code":"U40C300","system":"readv2"},{"code":"U40C400","system":"readv2"},{"code":"U40C500","system":"readv2"},{"code":"U40C600","system":"readv2"},{"code":"U40C700","system":"readv2"},{"code":"U40Cy00","system":"readv2"},{"code":"U40Cz00","system":"readv2"},{"code":"U40y.00","system":"readv2"},{"code":"U40y000","system":"readv2"},{"code":"U40y100","system":"readv2"},{"code":"U40y200","system":"readv2"},{"code":"U40y300","system":"readv2"},{"code":"U40y400","system":"readv2"},{"code":"U40y500","system":"readv2"},{"code":"U40y600","system":"readv2"},{"code":"U40y700","system":"readv2"},{"code":"U40yy00","system":"readv2"},{"code":"U40yz00","system":"readv2"},{"code":"U41..00","system":"readv2"},{"code":"U410.00","system":"readv2"},{"code":"U411.00","system":"readv2"},{"code":"U413.00","system":"readv2"},{"code":"U414.00","system":"readv2"},{"code":"U415.00","system":"readv2"},{"code":"U416.00","system":"readv2"},{"code":"U417.00","system":"readv2"},{"code":"U41z.00","system":"readv2"},{"code":"U72..00","system":"readv2"}];
REQUIRED_CODES = 1;
with open(sys.argv[1], 'r') as file_in, open('self-harm-potential-cases.csv', 'w', newline='') as file_out:
    csv_reader = csv.DictReader(file_in)
    csv_writer = csv.DictWriter(file_out, csv_reader.fieldnames + ["self-harm-intentionl---primary-identified"])
    csv_writer.writeheader();
    codes_identified = 0;
    for row in csv_reader:
        newRow = row.copy();
        for cell in row:
            # Iterate cell lists (e.g. codes)
            for item in re.findall(r'\(([^,]*)\,', row[cell]):
                if(item in list(map(lambda code: code['code'], codes))): codes_identified+=1;
                if(codes_identified>=REQUIRED_CODES):
                    newRow["self-harm-intentionl---primary-identified"] = "CASE";
                    break;
            if(codes_identified>=REQUIRED_CODES): break;
        if(codes_identified<REQUIRED_CODES):
            newRow["self-harm-intentionl---primary-identified"] = "UNK";
        codes_identified=0;
        csv_writer.writerow(newRow)
